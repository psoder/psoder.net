---
import { getCollection, render, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";

// oxlint-disable-next-line func-style typescript/explicit-module-boundary-types explicit-function-return-type
export async function getStaticPaths() {
    const posts: CollectionEntry<"blog">[] = await getCollection("blog");

    return posts
        .filter((post) => !post.id?.startsWith("."))
        .map((post) => ({
            params: { id: post.data?.slug ?? post.id },
            props: { post },
        }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const dateString = new Date(post.data.publicationDate).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
});

const WPM = 250;
// oxlint-disable-next-line oxc/no-optional-chaining no-magic-numbers
const readTime = Math.ceil((post.body ?? "").split(" ").length / WPM);
---

<Layout title={post.data.title}>
    <div class="mx-auto max-w-3xl px-4 sm:px-6 md:px-0">
        <header>
            <h1>{post.data.title}</h1>
            <div class="mt-2 flex items-center gap-2 text-sm opacity-70">
                <time datetime={post.data.publicationDate}>{dateString}</time>
                <span>•</span>
                <span>{readTime} minute read</span>
                <span>•</span>

                <a
                    href="/rss.xml"
                    class="inline-flex items-center gap-1 hover:opacity-100 transition"
                    aria-label="Subscribe via RSS"
                >
                    <Icon name="mdi:rss-feed" class="h-4 w-4" />
                    RSS
                </a>
            </div>
        </header>

        <article class="prose prose-invert prose-headings:scroll-mt-24">
            <Content />
        </article>

        <hr />

        <footer class="text-sm opacity-70">
            <a href="/blog">← Back to all posts</a>
        </footer>
    </div>
</Layout>
