---
import { getCollection, render, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";

// oxlint-disable-next-line func-style typescript/explicit-module-boundary-types explicit-function-return-type
export async function getStaticPaths() {
    const posts: CollectionEntry<"blog">[] = await getCollection("blog");

    return posts.map((post) => ({
        params: { id: post.id },
        props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const dateString = new Date(post.data.publicationDate).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
});

const WPM = 250;
// oxlint-disable-next-line oxc/no-optional-chaining no-magic-numbers
const readTime = Math.ceil((post.body ?? "").split(" ").length / WPM);
---

<Layout title={post.data.title}>
    <div class="mx-auto max-w-3xl px-4 sm:px-6 md:px-0">
        <header>
            <h1>{post.data.title}</h1>
            <p class="text-sm text-secondary opacity-80 flex gap-2 items-center">
                <time datetime={post.data.publicationDate}>{dateString}</time>
                <span>&#8226;</span>
                <span>{readTime} minute read</span>
            </p>
        </header>

        <article class="prose prose-invert prose-headings:scroll-mt-24">
            <Content />
        </article>

        <hr class="my-16 border-ctp-subtext1/20" />

        <footer class="text-sm opacity-70">
            <a href="/blog">‚Üê Back to all posts</a>
        </footer>
    </div>
</Layout>
